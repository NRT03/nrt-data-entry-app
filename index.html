<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N.R.T.</title>
    <link rel="stylesheet" href="tailwindcss.css">
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js').then(
                    registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    },
                    err => {
                        console.log('Service Worker registration failed:', err);
                    }
                );
            });
        }
    </script>
</head>
<body class="bg-gray-200 text-gray-900 font-sans p-4 dark:bg-gray-900 dark:text-gray-100">

    <div class="max-w-2xl mx-auto space-y-6">

        <header class="text-center">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-50">N.R.T. Data Entry App</h1>
            <p class="text-gray-600 dark:text-gray-400">Manage your sales data effortlessly</p>
        </header>

        <main class="space-y-6">

            <button id="toggle-view-btn" class="w-full bg-[#eac8a6] hover:bg-[#d6b797] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">
                Switch to Dashboard
            </button>

            <div id="form-view" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md space-y-4">
                <h2 class="text-xl font-bold text-center">Add New Sales Entry</h2>

                <form id="sales-form" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label for="date" class="block text-sm font-medium">Date</label>
                            <input type="date" id="date" name="date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" required>
                        </div>
                        <div class="space-y-1">
                            <label for="storeName" class="block text-sm font-medium">Store Name</label>
                            <select id="storeName" name="storeName" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" required>
                                <option value="" disabled selected>Select a store</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label for="mobileNumber" class="block text-sm font-medium">Mobile Number</label>
                            <input type="tel" id="mobileNumber" name="mobileNumber" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" required>
                            <p id="mobile-error" class="text-sm text-red-500 mt-1 hidden">Please enter a valid 11-digit number.</p>
                        </div>
                        <div class="space-y-1">
                            <label for="invoiceNumber" class="block text-sm font-medium">Invoice Number</label>
                            <input type="text" id="invoiceNumber" name="invoiceNumber" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                        </div>
                        <div class="space-y-1">
                            <label for="gadgetType" class="block text-sm font-medium">Gadget Type</label>
                            <select id="gadgetType" name="gadgetType" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" required>
                                <option value="" disabled selected>Select a gadget type</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label for="modelName" class="block text-sm font-medium">Model Name</label>
                            <input type="text" id="modelName" name="modelName" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                        </div>
                        <div class="space-y-1">
                            <label for="quantity" class="block text-sm font-medium">Quantity</label>
                            <input type="number" id="quantity" name="quantity" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" required>
                        </div>
                        <div class="space-y-1">
                            <label for="sellingPrice" class="block text-sm font-medium">Selling Price (BDT)</label>
                            <input type="number" id="sellingPrice" name="sellingPrice" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" step="0.01" required>
                        </div>
                        <div class="space-y-1 md:col-span-2">
                            <label for="totalRevenue" class="block text-sm font-medium">Total Revenue (BDT)</label>
                            <input type="number" id="totalRevenue" name="totalRevenue" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 cursor-not-allowed" step="0.01" readonly>
                        </div>
                        <div class="space-y-1 md:col-span-2">
                            <label for="due" class="block text-sm font-medium">Due (BDT)</label>
                            <input type="number" id="due" name="due" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" step="0.01">
                        </div>
                        <div class="flex items-center md:col-span-2">
                            <input type="checkbox" id="keep-shop-info" class="h-4 w-4 text-[#3d74b6] rounded focus:ring-blue-500">
                            <label for="keep-shop-info" class="ml-2 block text-sm font-medium">Keep shop info for next entry</label>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2 justify-end">
                        <button type="button" id="cancel-edit-btn" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 rounded-md text-white font-semibold hidden">Cancel Edit</button>
                        <button type="button" id="clear-form-btn" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded-md text-gray-800 font-semibold">Clear Form</button>
                        <button type="submit" id="submit-btn" class="px-4 py-2 bg-[#3d74b6] hover:bg-[#2d5f99] rounded-md text-white font-semibold">Submit</button>
                    </div>
                </form>

                <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold">Manage Stores and Gadgets</h3>
                        <div class="flex space-x-4">
                            <button id="manage-stores-toggle" class="manage-toggle-btn text-[#3d74b6]">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0a2 2 0 012-2h4a2 2 0 012 2m-2 2V6M5 13V9a2 2 0 012-2m0 0a2 2 0 012-2h4a2 2 0 012 2m-2 2V6M5 13v2a2 2 0 002 2m0 0a2 2 0 002 2h4a2 2 0 002-2m0 0v-2" />
                                </svg>
                            </button>
                            <button id="manage-gadgets-toggle" class="manage-toggle-btn text-[#dc3c22]">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 1 012 2v3m-4-3a2 2 1 004 0m-4 0a2 2 1 01-2 2v3m-4-3a2 2 1 01-2 2v3m12-3a2 2 1 01-2-2v3m0 0V9a2 2 0 00-2-2h-4a2 2 0 00-2 2v10m-2-5h10m-12-3a2 2 1 012 2v3m0 0V9a2 2 0 00-2-2h-4a2 2 0 00-2 2v10m-2-5h10m-12-3a2 2 1 012 2v3m0 0V9a2 2 0 00-2-2h-4a2 2 0 00-2 2v10m-2-5h10m-12-3a2 2 1 012 2v3m0 0V9a2 2 0 00-2-2h-4a2 2 0 00-2 2v10m-2-5h10m-12-3a2 2 1 012 2v3m0 0V9a2 2 0 00-2-2h-4a2 2 0 00-2 2v10m-2-5h10m-12-3a2 2 1 012 2v3m0 0V9a2 2 0 00-2-2h-4a2 2 0 00-2 2v10m-2-5h10" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div id="manage-stores-container" class="mt-4 hidden space-y-2">
                        <h4 class="text-sm font-bold">Manage Stores</h4>
                        <div class="flex space-x-2">
                            <input type="text" id="new-store-input" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" placeholder="New Store Name">
                            <button type="button" id="add-store-btn" class="p-2 bg-[#3d74b6] text-white rounded-md hover:bg-[#2d5f99] disabled:bg-gray-400" disabled>Add</button>
                        </div>
                        <div id="store-list" class="space-y-2 max-h-40 overflow-y-auto pr-2"></div>
                    </div>

                    <div id="manage-gadgets-container" class="mt-4 hidden space-y-2">
                        <h4 class="text-sm font-bold">Manage Gadgets</h4>
                        <div class="flex space-x-2">
                            <input type="text" id="new-gadget-input" class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700" placeholder="New Gadget Type">
                            <button type="button" id="add-gadget-btn" class="p-2 bg-[#3d74b6] text-white rounded-md hover:bg-[#2d5f99] disabled:bg-gray-400" disabled>Add</button>
                        </div>
                        <div id="gadget-list" class="space-y-2 max-h-40 overflow-y-auto pr-2"></div>
                    </div>
                </div>

                <div class="pt-4 border-t border-gray-200 dark:border-gray-700 mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">Sales Entries</h2>
                        <div class="flex space-x-2">
                            <button id="view-dues-btn" class="px-2 py-1 bg-[#fcd34d] hover:bg-[#eab308] rounded-md text-gray-800 text-sm font-semibold">View Dues</button>
                            <button id="export-btn" class="px-2 py-1 bg-[#3d74b6] hover:bg-[#2d5f99] rounded-md text-white text-sm font-semibold">Export to CSV</button>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2 mb-4">
                        <input type="text" id="search-input" placeholder="Search by mobile, invoice, store..." class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                        <button id="clear-search-btn" class="p-2 bg-gray-300 hover:bg-gray-400 rounded-md text-gray-800">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>

                    <div id="entries-list" class="space-y-4">
                        </div>
                </div>
            </div>

            <div id="dashboard-view" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md space-y-6 hidden">
                <h2 class="text-xl font-bold text-center">Sales Dashboard</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div class="bg-[#fbf5de] dark:bg-[#eac8a6] p-4 rounded-lg shadow-sm">
                        <h3 class="text-sm text-gray-700 dark:text-gray-900 font-semibold">Total Sales</h3>
                        <p id="total-sales" class="text-xl font-bold text-gray-900 dark:text-gray-900 mt-1">BDT 0.00</p>
                    </div>
                    <div class="bg-[#eac8a6] dark:bg-[#d68b55] p-4 rounded-lg shadow-sm">
                        <h3 class="text-sm text-gray-700 dark:text-gray-900 font-semibold">Total Due</h3>
                        <p id="total-due" class="text-xl font-bold text-gray-900 dark:text-gray-900 mt-1">BDT 0.00</p>
                    </div>
                    <div class="bg-[#fbf5de] dark:bg-[#eac8a6] p-4 rounded-lg shadow-sm">
                        <h3 class="text-sm text-gray-700 dark:text-gray-900 font-semibold">Total Shops</h3>
                        <p id="total-shops" class="text-xl font-bold text-gray-900 dark:text-gray-900 mt-1">0</p>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-lg font-bold text-center mb-2">Revenue by Date</h3>
                        <canvas id="revenue-chart"></canvas>
                    </div>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-lg font-bold text-center mb-2">Top Gadgets</h3>
                        <canvas id="gadget-sales-chart"></canvas>
                    </div>
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <h3 class="text-lg font-bold text-center mb-2">Sales by Store</h3>
                        <canvas id="store-sales-chart"></canvas>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div id="custom-modal" class="modal-overlay hidden">
        <div class="modal-box">
            <h3 id="modal-title" class="text-lg font-bold"></h3>
            <p id="modal-text" class="py-4"></p>
            <div class="modal-action">
                <button id="modal-confirm-btn" class="px-4 py-2 bg-[#3d74b6] hover:bg-[#2d5f99] rounded-md text-white font-semibold">OK</button>
            </div>
        </div>
    </div>
    
    <div class="notification-container"></div>
    
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
</body>
</html>
